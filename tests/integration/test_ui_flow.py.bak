import pytest
from playwright.sync_api import Page, expect
import time
import logging
import os

# Set up logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Get base URL from environment or use default
BASE_URL = os.environ.get('BASE_URL', 'http://localhost:3000')

# Test data
TEST_DATA = {
    'birthDate': '1990-01-15',
    'birthTime': '14:30',
    'birthLocation': 'New York, USA'
}

@pytest.fixture(scope='function', autouse=True)
def setup_browser_context(page: Page):
    """Configure the browser context before each test."""
    # Set the base URL
    page.context.set_default_navigation_timeout(60000)  # 60 seconds
    return page

def test_birth_details_form_submission(page: Page, mock_api_requests, enable_test_mode):
    """Test the full birth details form submission flow with proper error handling."""
    logger.info("Starting birth details form submission test")

    # Navigate to the application
    page.goto(f'{BASE_URL}/')
    logger.info("Navigated to application")

    # Look for the birth details form
    try:
        # Initialize form_found variable
        form_found = False

        # Try various form selectors to find the form
        form_selectors = [
            'form',
            '[data-testid="birth-form"]',
            '.birth-form-container',
            '[role="form"]',
            '#birth-form',
            '.form',
            '[name="birth-form"]',
            'form:has(input[type="date"])',
            'form:has(input[name="birthDate"])'
        ]

        # Also check specific elements inside forms
        input_selectors = [
            'input[type="date"]',
            'input[name="birthDate"]',
            'input[placeholder*="date"]',
            'input[type="time"]',
            'input[name="birthTime"]'
        ]

        # Look for specific input elements first
